<!Doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>CHESS</title>
        <link rel="stylesheet" href="css/chessboard-1.0.0.min.css">
        <style>
            .highlight-yellow {
              box-shadow: inset 0 0 3px 3px yellow;
            }
            .highlight-blue {
              box-shadow: inset 0 0 3px 3px blue;
            }
            .highlight-green {
              box-shadow: inset 0 0 3px 3px green;
            }
        </style>
        <script src="js/jquery-3.5.1.min.js"></script>
        <script src="js/chessboard-1.0.0.min.js"></script>
        <script src="game.js"></script>
        <script src="utils.js"></script>
    </head>
    <body>
        <div id="settings">
                <input type="radio" id="orderSorted" name="order" value="sorted" checked />
                <label for="orderSorted">Sorted</label>
                <input type="radio" id="orderRandom" name="order" value="random"/>
                <label for="orderRandom">Random</label>

                <button id="reset">Reset</button>
                <button id="hint">Hint</button>
        </div>
        <div id="board" style="width: 800px"></div>
        <div id="message"></div>
        <script src="puzzle.js"></script>
        <script type="text/javascript">
            function message(s) {
                $("#message").html(s);
            }
            function restart() {
                let startingPosition = {'d5': 'bQ', 'h8': 'wN'};
                const url = new URL(document.URL);
                const fen = url.searchParams.get('fen')
                if (fen) {
                    startingPosition = ChessBoard.fenToObj(fen);
                }

                const config = {
                    startingPosition: startingPosition,
                    randomize: $("#orderRandom").prop("checked"),
                    onTargetReached: (state, history) => {
                        console.log(state.time, state.path, state.best_path, history.length);
                        if (state.path.length == state.best_path.length) {
                            message(`⭐ Perfect!<br> ${state.time/1000} seconds`);
                        } else if (state.path.length <= state.best_path.length+2) {
                            message(`✅ Excellent!<br> ${state.time/1000} seconds`);
                        } else {
                            message(`✅ Good!<br> ${state.time/1000} seconds`);
                        }
                    },
                    onComplete: (history) => {
                        console.log('COMPLETE', history);
                        const time = history.map(x=>x.time).reduce((a,b)=>a+b)/1000;

                        const minutes = Math.floor(time/60);
                        const seconds = time-60*minutes;

                        message(`${minutes}:${seconds}`);
                    }
                }
                console.log(config);
                puzzle.restart(config);
            }
            function hint() {
                console.log(puzzle.hint()[1]);
                message(puzzle.hint()[1]);
            }
            const puzzle = new Puzzle("#board");
            $("#reset").click(restart);
            $("#hint").click(hint);

            restart();
        </script>
    </body>
</html>
